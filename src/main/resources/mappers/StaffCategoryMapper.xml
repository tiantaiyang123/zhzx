<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhzx.server.repository.StaffCategoryMapper">
    <!--<resultMap id="ResultMap" type="com.zhzx.server.dto.StaffCategoryDto" extends="com.zhzx.server.repository.base.StaffCategoryBaseMapper.BaseResultMap">-->
        <!--<collection property="staffCategoryRelations" columnPrefix="sscr_"  resultMap="com.zhzx.server.repository.base.StaffCategoryRelationBaseMapper.ResultMap">-->
            <!--<constructor>-->
                <!--<arg column="staffCategoryRelations"/>-->
            <!--</constructor>-->
        <!--</collection>-->
    <!--</resultMap>-->
    <resultMap id="ResultMap" type="com.zhzx.server.dto.StaffCategoryDto" extends="com.zhzx.server.repository.base.StaffCategoryBaseMapper.BaseResultMap">
        <result column="staffId" jdbcType="BIGINT" property="staffId" />
        <collection column="{staffId = staffId ,id = id}" property="staffCategoryRelations" select="queryStaff" />
    </resultMap>

    <!-- 根据主键查询 -->
    <select id="selectById" parameterType="java.io.Serializable" resultMap="com.zhzx.server.repository.base.StaffCategoryBaseMapper.ResultMap">
        select * from sys_staff_category where id = #{id}
    </select>
    <!-- 根据Wrapper查询 -->
    <select id="selectOne" resultMap="com.zhzx.server.repository.base.StaffCategoryBaseMapper.ResultMap">
        select * from sys_staff_category ${ew.customSqlSegment} LIMIT 1
    </select>

    <!--<select id="selectCategory" resultMap="com.zhzx.server.repository.StaffCategoryMapper.ResultMap">-->
        <!--select ssc.*,-->
        <!--sscr.id as sscr_id ,-->
        <!--sscr.parent_category as sscr_parentCategory ,-->
        <!--sscr.staff_category_id as sscr_staffCategoryId,-->
        <!--sscr.staff_id as sscr_staffId-->
        <!--from sys_staff_category ssc-->
        <!--left join sys_staff_category_relation sscr on ssc.id = sscr.staff_category_id-->
        <!--where 1=1-->
        <!--<if test="staffId != null">-->
            <!--and sscr.staff_id in-->
            <!--(-->
            <!--select ssmrr.receiver_id from sys_staff_message_receiver_relation ssmrr-->
            <!--left join sys_staff_message ssm on ssm.id = ssmrr.staff_message_id-->
            <!--where ssmrr.receiver_type = 'TEACHER' and ssm.staff_id = #{staffId}-->
            <!--)-->
        <!--</if>-->
    <!--</select>-->
    <select id="selectCategory" resultMap="com.zhzx.server.repository.StaffCategoryMapper.ResultMap">
        select ssc.*,#{staffId} as staffId
        from sys_staff_category ssc
    </select>

    <select id="queryStaff" resultMap="com.zhzx.server.repository.base.StaffCategoryRelationBaseMapper.ResultMap">
        select sscr.*
        from sys_staff_category_relation sscr
        where sscr.staff_category_id = #{id}
        <if test="staffId != null">
          and sscr.staff_id in (
            select ssmrr.receiver_id from sys_staff_message_receiver_relation ssmrr
            left join sys_staff_message ssm on ssm.id = ssmrr.staff_message_id
            where ssmrr.receiver_type = 'TEACHER' and ssm.staff_id = #{staffId}
            )
        </if>
    </select>
</mapper>
